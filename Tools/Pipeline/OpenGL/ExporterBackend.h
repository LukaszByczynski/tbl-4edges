///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// This software is supplied under the terms of a license agreement or
// nondisclosure agreement and may not be copied or disclosed except in
// accordance with the terms of that agreement.
//
// Copyright (c) 2005 Jesper Svennevid, Daniel Collin.
// All Rights Reserved.
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#ifndef zenic_opengl_ExporterBackend_h
#define zenic_opengl_ExporterBackend_h

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "../ExporterBackend.h"

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class CSLShader;

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace zenic
{
	namespace opengl
	{

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class ExporterBackend : public zenic::ExporterBackend
{
public:
	
	zenic::ModelData* buildModelData(CSLModel* mesh, Model* modelNode);
	zenic::Material* buildMaterial(CSLXSIMaterial* material);
	Serializable* buildTexture(CSLImage* image, CSIBCPixMap& pixMap);

private:

	struct SkinInfo
	{
		inline SkinInfo() : count(0) {}

		uint count;
		u32 indices[4];
		float weights[4];
	};

	void traverseShaders(CSLShader* shader, uint level);

	SkinInfo* buildSkinInfo(CSLModel* model, Model* modelNode, u32* remapTable);
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	}
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#endif