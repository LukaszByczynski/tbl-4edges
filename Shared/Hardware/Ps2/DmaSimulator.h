///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// This software is supplied under the terms of a license agreement or
// nondisclosure agreement and may not be copied or disclosed except in
// accordance with the terms of that agreement.
//
// Copyright (c) 2004 Jesper Svennevid, Daniel Collin.
// All Rights Reserved.
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#ifndef zenic_ps2_hardware_DmaSimulator_h
#define zenic_ps2_hardware_DmaSimulator_h

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// includes
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <Shared/Base/Types.h>

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// forwards
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// class
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace zenic
{
	namespace ps2
	{

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class DmaSimulator
{
public:
	DmaSimulator();
	~DmaSimulator();
	void start(u32* ptr);
protected:
	void disdma(u32* ptr);
	void disdata(u32 *ptr, int num);
	void disvif(u32 data, u32* ptr);
	void disgif(u32 data);
	void disad(int reg, u64 data);
	u32 readWord(u32 ptr);
	enum VIFSTATE { VS_READTAG, VS_DIRECT, VS_MPG, VS_UNPACK };
	VIFSTATE vifstate;
	enum GIFSTATE { GS_READTAG, GS_PACKED, GS_IMAGE };
	GIFSTATE gifstate;
	int gifqcount;
	int gifcount;
	//u128 giftag;
	//u128 gifqword;
	int nreg;
	int vifcount;
	int timeout;
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	}

}

#endif //zenic_ps2_hardware_DmaSimulator_h




