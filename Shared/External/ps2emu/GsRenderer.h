#ifndef ps2emu_GsRenderer_h
#define ps2emu_GsRenderer_h

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "datatypes.h"

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace ps2emu
{
	class BufferStream;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace ps2emu
{

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class GsRenderer
{
public:
	GsRenderer(bool trace);

	static void callback(void* userData, const void* gifData);

private:

	void readTag(BufferStream& bufferStream);
	void process(const void* gifData);

	void processReg(u32 reg, BufferStream& stream);
	void prim(u32 prim);

	bool m_trace;

	enum Mode
	{
		Tag,
		Packed,
		Reglist,
		Image
	};

	struct GifTag
	{
		u32 nloop;
		u32 eop;
		u32 pre;
		u32 prim;
		u32 flg;
		u32 nreg;
		u64 regs;
	};

	enum Primitive
	{
		Point,
		Line,
		Linestrip,
		Triangle,
		Tristrip,
		Trifan,
		Sprite
	};

	struct Prim
	{
		Primitive prim:3;
		u32 iip:1; 
		u32 tme:1; 
		u32 fge:1; 
		u32 abe:1; 
		u32 aa1:1;
		u32 fst:1;
		u32 ctxt:1;
		u32	fix:1; 
	};

	GifTag m_tag;
	Prim m_prim;

	Mode m_mode;

};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#endif